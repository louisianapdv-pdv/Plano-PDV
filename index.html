<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV Adega System - Plataforma Completa</title>
    <link rel="icon" href="logo.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="logo.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Bibliotecas externas -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <style>
        :root {
            --primary-color: #1a1a1a;
            --secondary-color: #333;
            --accent-color: #4f46e5;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --gray-color: #6b7280;
            --border-radius: 12px;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* ===== CONTAINER PRINCIPAL ===== */
        .main-container {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            min-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        /* ===== HEADER DO SISTEMA ===== */
        .system-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 50;
        }

        .system-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
        }

        .system-logo i {
            font-size: 2rem;
            color: var(--accent-color);
        }

        .system-logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .system-logo span {
            color: var(--accent-color);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--accent-color);
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-name {
            font-weight: 600;
            color: white;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ===== CONTEÚDO PRINCIPAL ===== */
        .content-wrapper {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 250px;
            background: var(--light-color);
            border-right: 1px solid #e5e7eb;
            padding: 1.5rem 0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 1.5rem;
            padding: 0 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-color);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.75rem 1rem;
            color: var(--dark-color);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 4px;
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(79, 70, 229, 0.1);
            color: var(--accent-color);
        }

        .nav-item.active {
            background: var(--accent-color);
            color: white;
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .subscription-status {
            margin-top: auto;
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }

        .subscription-status h4 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .subscription-status p {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .btn-renew {
            background: white;
            color: var(--accent-color);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
        }

        .btn-renew:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ===== ÁREA DE CONTEÚDO ===== */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: #f9fafb;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: 2rem;
        }

        .section-header h2 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .section-header p {
            color: var(--gray-color);
            font-size: 1rem;
        }

        /* ===== PÁGINA DE LOGIN ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
            padding: 3rem;
            text-align: center;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            margin-bottom: 2rem;
        }

        .login-logo i {
            font-size: 3.5rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        .login-logo h1 {
            font-size: 2.2rem;
            color: var(--dark-color);
            font-weight: 700;
        }

        .login-logo span {
            color: var(--accent-color);
        }

        .login-message {
            margin-bottom: 2rem;
            color: var(--gray-color);
            line-height: 1.6;
        }

        .btn-google {
            background-color: #fff;
            color: #444;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .btn-google:hover {
            background-color: #f8f9fa;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-google img {
            width: 20px;
            height: 20px;
        }

        .login-divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: var(--gray-color);
        }

        .login-divider::before, .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: #e5e7eb;
        }

        .login-divider span {
            padding: 0 15px;
        }

        .admin-only {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 2rem;
            font-size: 0.9rem;
            color: #856404;
        }

        .admin-only i {
            color: #f39c12;
            margin-right: 8px;
        }

        .login-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 1rem;
            color: #721c24;
            display: none;
        }

        /* ===== PÁGINA DE PLANOS ===== */
        .plans-section {
            padding: 2rem 0;
        }

        .plans-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .plan-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
            position: relative;
        }

        .plan-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .plan-card.popular {
            border: 3px solid var(--accent-color);
            transform: scale(1.05);
        }

        .plan-card.popular:hover {
            transform: scale(1.05) translateY(-10px);
        }

        .plan-badge {
            position: absolute;
            top: 20px;
            right: -30px;
            background-color: var(--accent-color);
            color: white;
            padding: 8px 30px;
            font-weight: 600;
            transform: rotate(45deg);
            font-size: 0.9rem;
        }

        .plan-header {
            padding: 2rem;
            text-align: center;
            color: white;
        }

        .plan-basic .plan-header {
            background: linear-gradient(to right, #3498db, #2980b9);
        }

        .plan-pro .plan-header {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }

        .plan-premium .plan-header {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }

        .plan-title {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .plan-price {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .plan-period {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .plan-features {
            padding: 2rem;
        }

        .plan-features ul {
            list-style: none;
            margin-bottom: 2rem;
        }

        .plan-features li {
            padding: 10px 0;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .plan-features li i.fa-check {
            color: var(--success-color);
        }

        .plan-features li i.fa-times {
            color: var(--danger-color);
        }

        .plan-footer {
            padding: 0 2rem 2rem;
            text-align: center;
        }

        .btn-select-plan {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
        }

        .btn-select-plan:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        /* ===== PÁGINA DE PAGAMENTO PIX ===== */
        .payment-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .pix-box {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-top: 2rem;
        }

        .payment-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .payment-header h3 {
            font-size: 1.5rem;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .payment-header p {
            color: var(--gray-color);
        }

        .pix-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 2rem;
            padding: 15px;
            border-radius: 8px;
            background: #e8f5e9;
            color: #2e7d32;
            font-weight: 600;
        }

        .pix-status.pending {
            background: #fff3e0;
            color: #ef6c00;
        }

        .pix-status.error {
            background: #ffebee;
            color: #c62828;
        }

        .pix-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .pix-content {
                grid-template-columns: 1fr;
            }
        }

        .qr-section, .code-section {
            text-align: center;
        }

        .qr-section h4, .code-section h4 {
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .qr-container {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        #pixQrCode {
            width: 250px;
            height: 250px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .pix-code-box {
            background: #f1f3f4;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 2px solid #e0e0e0;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .pix-code-box:hover {
            background: #e8f0fe;
            border-color: var(--accent-color);
        }

        .pix-code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            color: var(--dark-color);
            line-height: 1.5;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 15px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: #4338ca;
        }

        .copy-btn.copied {
            background: var(--success-color);
        }

        .timer-section {
            text-align: center;
            margin: 2rem 0;
        }

        .timer-title {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--gray-color);
        }

        .timer {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }

        .timer-warning {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .instructions {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .instructions h4 {
            color: var(--dark-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions ol {
            margin-left: 1.5rem;
        }

        .instructions li {
            margin-bottom: 0.8rem;
            padding-left: 0.5rem;
        }

        .order-summary {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: var(--shadow);
        }

        .order-summary h4 {
            margin-bottom: 1.5rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f1f5f9;
        }

        .summary-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #f1f5f9;
        }

        /* ===== PDV SYSTEM (Embedded) ===== */
        .pdv-embed-container {
            width: 100%;
            height: calc(100vh - 200px);
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: white;
        }

        #pdvFrame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ===== BOTÕES GERAIS ===== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* ===== MODAL DE CONFIRMAÇÃO ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h3 {
            color: var(--dark-color);
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                padding: 1rem;
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
            }

            .nav-section {
                padding: 0 1rem;
            }

            .nav-items {
                display: flex;
                overflow-x: auto;
                gap: 1rem;
            }

            .nav-item {
                white-space: nowrap;
            }
        }

        @media (max-width: 768px) {
            .system-header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .user-menu {
                width: 100%;
                justify-content: space-between;
            }

            .main-content {
                padding: 1.5rem;
            }

            .plan-card.popular {
                transform: none;
            }

            .plan-card.popular:hover {
                transform: translateY(-10px);
            }
        }

        @media (max-width: 640px) {
            .login-box {
                padding: 2rem;
            }

            .plans-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Página de Login (inicial) -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-cash-register"></i>
                <h1>PDV<span>Adega</span></h1>
            </div>
            
            <div class="login-message">
                <p>Bem-vindo ao sistema PDV Adega. Faça login para acessar sua conta ou adquirir um plano.</p>
            </div>
            
            <button id="googleLoginBtn" class="btn-google">
                <img src="https://www.google.com/favicon.ico" alt="Google">
                Entrar com Google
            </button>
            
            <div class="login-divider">
                <span>ou</span>
            </div>
            
            <div class="admin-only">
                <i class="fas fa-shield-alt"></i>
                <strong>Acesso Administrativo:</strong> Se você já tem um plano ativo, faça login para acessar o PDV.
            </div>
            
            <div id="loginError" class="login-error">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorMessage">Erro ao fazer login. Tente novamente.</span>
            </div>
        </div>
    </div>

    <!-- Sistema Principal (após login) -->
    <div id="appContainer" class="main-container" style="display: none;">
        <!-- Header do Sistema -->
        <header class="system-header">
            <a href="#" class="system-logo" onclick="showSection('dashboard')">
                <i class="fas fa-cash-register"></i>
                <h1>PDV<span>Adega</span> System</h1>
            </a>
            
            <div class="user-menu">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="user-name" id="userName">Usuário</span>
                </div>
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    Sair
                </button>
            </div>
        </header>

        <!-- Conteúdo Principal -->
        <div class="content-wrapper">
            <!-- Sidebar de Navegação -->
            <nav class="sidebar">
                <div class="nav-section">
                    <h3>Menu Principal</h3>
                    <div class="nav-items">
                        <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                            <i class="fas fa-home"></i>
                            Dashboard
                        </a>
                        <a href="#" class="nav-item" onclick="showSection('pdv')">
                            <i class="fas fa-shopping-cart"></i>
                            PDV Adega
                        </a>
                        <a href="#" class="nav-item" onclick="showSection('plans')">
                            <i class="fas fa-credit-card"></i>
                            Planos
                        </a>
                        <a href="#" class="nav-item" onclick="showSection('payment')">
                            <i class="fas fa-qrcode"></i>
                            Pagar via PIX
                        </a>
                        <a href="#" class="nav-item" onclick="showSection('history')">
                            <i class="fas fa-history"></i>
                            Histórico
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <h3>Administrativo</h3>
                    <div class="nav-items">
                        <a href="#" class="nav-item" onclick="showSection('products')">
                            <i class="fas fa-box"></i>
                            Produtos
                        </a>
                        <a href="#" class="nav-item" onclick="showSection('reports')">
                            <i class="fas fa-chart-bar"></i>
                            Relatórios
                        </a>
                        <a href="#" class="nav-item" onclick="showSection('settings')">
                            <i class="fas fa-cog"></i>
                            Configurações
                        </a>
                    </div>
                </div>
                
                <!-- Status da Assinatura -->
                <div class="subscription-status" id="subscriptionStatus">
                    <h4>Seu Plano</h4>
                    <p id="currentPlan">Básico</p>
                    <p id="expiryDate">Expira em: --/--/----</p>
                    <button class="btn-renew" onclick="showSection('plans')">
                        <i class="fas fa-sync-alt"></i>
                        Renovar Plano
                    </button>
                </div>
            </nav>

            <!-- Área de Conteúdo -->
            <main class="main-content">
                <!-- Dashboard -->
                <section id="dashboard-section" class="content-section active">
                    <div class="section-header">
                        <h2>Dashboard</h2>
                        <p>Bem-vindo de volta ao PDV Adega System</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div style="background: white; padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-shopping-cart" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: var(--gray-color);">Vendas Hoje</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--dark-color);" id="salesToday">0</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-dollar-sign" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: var(--gray-color);">Receita Hoje</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--dark-color);" id="revenueToday">R$ 0,00</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-box" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: var(--gray-color);">Produtos em Estoque</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--dark-color);" id="stockProducts">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <h3 style="margin-bottom: 1.5rem; color: var(--dark-color);">Acesso Rápido</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <button class="btn btn-primary" onclick="showSection('pdv')">
                                <i class="fas fa-cash-register"></i>
                                Abrir PDV
                            </button>
                            <button class="btn btn-success" onclick="showSection('products')">
                                <i class="fas fa-box"></i>
                                Gerenciar Produtos
                            </button>
                            <button class="btn btn-warning" onclick="showSection('payment')">
                                <i class="fas fa-qrcode"></i>
                                Gerar PIX
                            </button>
                            <button class="btn" style="background: var(--accent-color); color: white;" onclick="showSection('reports')">
                                <i class="fas fa-chart-bar"></i>
                                Ver Relatórios
                            </button>
                        </div>
                    </div>
                </section>

                <!-- PDV Adega -->
                <section id="pdv-section" class="content-section">
                    <div class="section-header">
                        <h2>PDV Adega</h2>
                        <p>Sistema de ponto de venda completo para sua adega</p>
                    </div>
                    
                    <div class="pdv-embed-container">
                        <!-- O PDV será carregado aqui -->
                        <div id="pdvContent" style="width: 100%; height: 100%;">
                            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--gray-color);">
                                <div style="text-align: center;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                    <p>Carregando PDV Adega...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Planos -->
                <section id="plans-section" class="content-section">
                    <div class="section-header">
                        <h2>Planos Disponíveis</h2>
                        <p>Escolha o plano ideal para o seu negócio</p>
                    </div>
                    
                    <div class="plans-container">
                        <!-- Plano Básico -->
                        <div class="plan-card plan-basic">
                            <div class="plan-header">
                                <h3 class="plan-title">Básico</h3>
                                <div class="plan-price">R$ 49,90</div>
                                <div class="plan-period">por mês</div>
                            </div>
                            <div class="plan-features">
                                <ul>
                                    <li><i class="fas fa-check"></i> Até 100 vendas/mês</li>
                                    <li><i class="fas fa-check"></i> 1 usuário</li>
                                    <li><i class="fas fa-check"></i> Suporte por e-mail</li>
                                    <li><i class="fas fa-check"></i> Relatórios básicos</li>
                                    <li><i class="fas fa-times"></i> Backup automático</li>
                                    <li><i class="fas fa-times"></i> Multiplos usuários</li>
                                </ul>
                            </div>
                            <div class="plan-footer">
                                <button class="btn-select-plan" onclick="selectPlan('Básico', 49.90)">
                                    Selecionar Plano
                                </button>
                            </div>
                        </div>

                        <!-- Plano Profissional -->
                        <div class="plan-card plan-pro popular">
                            <div class="plan-badge">MAIS POPULAR</div>
                            <div class="plan-header">
                                <h3 class="plan-title">Profissional</h3>
                                <div class="plan-price">R$ 99,90</div>
                                <div class="plan-period">por mês</div>
                            </div>
                            <div class="plan-features">
                                <ul>
                                    <li><i class="fas fa-check"></i> Até 500 vendas/mês</li>
                                    <li><i class="fas fa-check"></i> Até 3 usuários</li>
                                    <li><i class="fas fa-check"></i> Suporte prioritário</li>
                                    <li><i class="fas fa-check"></i> Relatórios avançados</li>
                                    <li><i class="fas fa-check"></i> Backup automático</li>
                                    <li><i class="fas fa-times"></i> Integração com ERP</li>
                                </ul>
                            </div>
                            <div class="plan-footer">
                                <button class="btn-select-plan" onclick="selectPlan('Profissional', 99.90)">
                                    Selecionar Plano
                                </button>
                            </div>
                        </div>

                        <!-- Plano Premium -->
                        <div class="plan-card plan-premium">
                            <div class="plan-header">
                                <h3 class="plan-title">Premium</h3>
                                <div class="plan-price">R$ 199,90</div>
                                <div class="plan-period">por mês</div>
                            </div>
                            <div class="plan-features">
                                <ul>
                                    <li><i class="fas fa-check"></i> Vendas ilimitadas</li>
                                    <li><i class="fas fa-check"></i> Até 10 usuários</li>
                                    <li><i class="fas fa-check"></i> Suporte 24/7</li>
                                    <li><i class="fas fa-check"></i> Relatórios personalizados</li>
                                    <li><i class="fas fa-check"></i> Backup em nuvem</li>
                                    <li><i class="fas fa-check"></i> Integração com ERP</li>
                                </ul>
                            </div>
                            <div class="plan-footer">
                                <button class="btn-select-plan" onclick="selectPlan('Premium', 199.90)">
                                    Selecionar Plano
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Pagamento PIX -->
                <section id="payment-section" class="content-section">
                    <div class="payment-container">
                        <div class="section-header">
                            <h2>Pagamento via PIX</h2>
                            <p>Pague seu plano de forma rápida e segura</p>
                        </div>
                        
                        <div class="pix-box">
                            <div class="payment-header">
                                <h3>Gerar QR Code PIX</h3>
                                <p>Escaneie o código abaixo com seu aplicativo bancário</p>
                            </div>
                            
                            <div class="pix-status" id="pixStatus">
                                <i class="fas fa-clock"></i>
                                <span>Aguardando seleção do plano...</span>
                            </div>
                            
                            <div id="pixContent" style="display: none;">
                                <div class="pix-content">
                                    <div class="qr-section">
                                        <h4>QR Code para pagamento</h4>
                                        <div class="qr-container">
                                            <div id="pixQrCode"></div>
                                        </div>
                                        <p style="color: var(--gray-color);">
                                            Escaneie com seu app bancário
                                        </p>
                                    </div>
                                    
                                    <div class="code-section">
                                        <h4>Código PIX Copia e Cola</h4>
                                        <div class="pix-code-box" onclick="copyPixCode()">
                                            <button class="copy-btn" id="copyBtn">
                                                <i class="fas fa-copy"></i> Copiar
                                            </button>
                                            <div class="pix-code" id="pixCode">
                                                Aguardando geração do código PIX...
                                            </div>
                                        </div>
                                        <p style="color: var(--gray-color);">
                                            Copie o código e cole no app do seu banco
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="timer-section">
                                    <div class="timer-title">Tempo restante para pagamento</div>
                                    <div class="timer" id="pixTimer">30:00</div>
                                    <div style="color: var(--gray-color); font-size: 0.9rem;">
                                        Este QR Code expira em <span id="expiryTime">30 minutos</span>
                                    </div>
                                </div>
                                
                                <div class="instructions">
                                    <h4><i class="fas fa-info-circle"></i> Como pagar com PIX</h4>
                                    <ol>
                                        <li>Abra o aplicativo do seu banco</li>
                                        <li>Procure pela opção "Pagar com PIX"</li>
                                        <li>Escaneie o QR Code ou cole o código PIX</li>
                                        <li>Confira os dados e confirme o pagamento</li>
                                        <li>O sistema será liberado automaticamente</li>
                                    </ol>
                                </div>
                            </div>
                            
                            <div class="order-summary" id="orderSummary" style="display: none;">
                                <h4><i class="fas fa-receipt"></i> Resumo do Pedido</h4>
                                
                                <div class="summary-item">
                                    <span>Plano selecionado:</span>
                                    <span id="selectedPlanName">--</span>
                                </div>
                                
                                <div class="summary-item">
                                    <span>Valor:</span>
                                    <span id="selectedPlanPrice">R$ 0,00</span>
                                </div>
                                
                                <div class="summary-item">
                                    <span>Válido por:</span>
                                    <span>30 dias</span>
                                </div>
                                
                                <div class="summary-item summary-total">
                                    <span>Total:</span>
                                    <span id="totalPrice">R$ 0,00</span>
                                </div>
                                
                                <button class="btn btn-success btn-block" onclick="verifyPayment()" style="margin-top: 1.5rem;">
                                    <i class="fas fa-check-circle"></i> Já fiz o pagamento
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Outras seções (simplificadas) -->
                <section id="history-section" class="content-section">
                    <div class="section-header">
                        <h2>Histórico</h2>
                        <p>Seu histórico de pagamentos e atividades</p>
                    </div>
                    <div style="background: white; padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <p style="color: var(--gray-color);">Histórico será carregado aqui...</p>
                    </div>
                </section>

                <section id="products-section" class="content-section">
                    <div class="section-header">
                        <h2>Produtos</h2>
                        <p>Gerencie seu catálogo de produtos</p>
                    </div>
                    <div style="background: white; padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <p style="color: var(--gray-color);">Gestão de produtos será carregada aqui...</p>
                    </div>
                </section>

                <section id="reports-section" class="content-section">
                    <div class="section-header">
                        <h2>Relatórios</h2>
                        <p>Análises e insights do seu negócio</p>
                    </div>
                    <div style="background: white; padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <p style="color: var(--gray-color);">Relatórios serão carregados aqui...</p>
                    </div>
                </section>

                <section id="settings-section" class="content-section">
                    <div class="section-header">
                        <h2>Configurações</h2>
                        <p>Personalize seu sistema</p>
                    </div>
                    <div style="background: white; padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                        <p style="color: var(--gray-color);">Configurações serão carregadas aqui...</p>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar Ação</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conteúdo dinâmico -->
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal()">Cancelar</button>
                <button class="btn btn-primary" id="modalConfirmBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURAÇÃO FIREBASE =====
        const firebaseConfig = {
            apiKey: "AIzaSyBuob65d4nwic1hXTGSsLtc38dEoD1H0zU",
            authDomain: "pdv26-aa76b.firebaseapp.com",
            projectId: "pdv26-aa76b",
            storageBucket: "pdv26-aa76b.firebasestorage.app",
            messagingSenderId: "885941177258",
            appId: "1:885941177258:web:98f2690e07ec0a087cf9d3",
            measurementId: "G-6BT5HW6JV8"
        };

        // ===== CONFIGURAÇÃO MERCADO PAGO =====
        const MERCADO_PAGO_CONFIG = {
            publicKey: 'APP_USR-3b0abda0-39e7-4cdf-a6c2-7ad74c830bcc',
            accessToken: 'APP_USR-6861213688084120-122618-45b758a772d0bc0a11496a521d116a17-2933530645',
            userId: '2933530645'
        };

        // ===== INICIALIZAÇÃO =====
        let currentUser = null;
        let db = null;
        let currentPlan = null;
        let pixTransactionId = null;
        let timerInterval = null;
        let timeLeft = 30 * 60;
        let selectedPlanData = null;

        // Emails autorizados para administração
        const ADMIN_EMAILS = [
            "admin@pdvsystem.com",
            "pablohenriquerodriguesgracioli@gmail.com" // ADICIONE SEU EMAIL AQUI
        ];

        // Planos disponíveis
        const PLANS = {
            'Básico': { price: 49.90, features: ['100 vendas/mês', '1 usuário', 'Suporte email'] },
            'Profissional': { price: 99.90, features: ['500 vendas/mês', '3 usuários', 'Suporte prioritário'] },
            'Premium': { price: 199.90, features: ['Vendas ilimitadas', '10 usuários', 'Suporte 24/7'] }
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // ===== FUNÇÕES DE AUTENTICAÇÃO =====
        function initAuth() {
            auth.onAuthStateChanged(async (user) => {
                currentUser = user;
                
                if (user) {
                    // Verificar se é admin ou tem plano ativo
                    const userData = await getUserData(user.uid);
                    
                    if (ADMIN_EMAILS.includes(user.email) || (userData && userData.activePlan)) {
                        // Tem acesso ao sistema
                        showApp(user, userData);
                    } else {
                        // Não tem plano ativo, mostrar página de planos
                        showApp(user, null);
                        showSection('plans');
                    }
                } else {
                    showLoginPage();
                }
            });
        }

        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    saveUserData(user);
                })
                .catch((error) => {
                    console.error("Erro no login:", error);
                    showLoginError("Erro ao fazer login. Tente novamente.");
                });
        }

        function logout() {
            auth.signOut()
                .then(() => {
                    showLoginPage();
                })
                .catch((error) => {
                    console.error("Erro ao fazer logout:", error);
                });
        }

        async function getUserData(userId) {
            try {
                const snapshot = await database.ref('users/' + userId).once('value');
                return snapshot.val();
            } catch (error) {
                console.error("Erro ao buscar dados do usuário:", error);
                return null;
            }
        }

        async function saveUserData(user) {
            const userData = {
                name: user.displayName,
                email: user.email,
                photoURL: user.photoURL,
                lastLogin: new Date().toISOString()
            };
            
            try {
                await database.ref('users/' + user.uid).set(userData);
            } catch (error) {
                console.error("Erro ao salvar dados do usuário:", error);
            }
        }

        // ===== CONTROLE DE INTERFACE =====
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginError').style.display = 'none';
        }

        function showApp(user, userData) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            
            // Atualizar informações do usuário
            document.getElementById('userName').textContent = user.displayName || user.email;
            
            const userAvatar = document.getElementById('userAvatar');
            if (user.photoURL) {
                userAvatar.innerHTML = `<img src="${user.photoURL}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%;">`;
            } else {
                const initials = (user.displayName || user.email).charAt(0).toUpperCase();
                userAvatar.innerHTML = `<span>${initials}</span>`;
            }
            
            // Atualizar status da assinatura
            if (userData && userData.activePlan) {
                currentPlan = userData.activePlan;
                document.getElementById('currentPlan').textContent = userData.activePlan.name || 'Ativo';
                document.getElementById('expiryDate').textContent = `Expira em: ${formatDate(userData.activePlan.expiryDate)}`;
                
                // Se tem plano ativo, carregar o PDV
                if (userData.activePlan.status === 'active') {
                    loadPDV();
                }
            } else {
                document.getElementById('currentPlan').textContent = 'Sem Plano';
                document.getElementById('expiryDate').textContent = 'Adquira um plano para acessar o PDV';
            }
        }

        function showLoginError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('loginError').style.display = 'block';
        }

        function showSection(sectionId) {
            // Esconder todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remover classe active de todos os itens do menu
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Mostrar a seção selecionada
            const section = document.getElementById(sectionId + '-section');
            if (section) {
                section.classList.add('active');
            }
            
            // Ativar o item do menu correspondente
            const navItem = document.querySelector(`.nav-item[onclick*="${sectionId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Se for a seção do PDV e o usuário tem plano ativo
            if (sectionId === 'pdv' && currentPlan) {
                loadPDV();
            }
        }

        // ===== FUNÇÕES DO PDV =====
        function loadPDV() {
            const pdvContent = document.getElementById('pdvContent');
            if (!pdvContent) return;
            
            // Se já carregou o PDV, apenas mostrar
            if (pdvContent.dataset.loaded === 'true') {
                return;
            }
            
            // Simular carregamento do PDV
            pdvContent.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%;">
                    <div style="text-align: center;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 1rem; color: var(--accent-color);"></i>
                        <p style="color: var(--gray-color);">Carregando PDV Adega...</p>
                        <p style="color: var(--gray-color); font-size: 0.875rem; margin-top: 1rem;">
                            Se o PDV não carregar automaticamente, <a href="#" onclick="reloadPDV()" style="color: var(--accent-color);">clique aqui</a>
                        </p>
                    </div>
                </div>
            `;
            
            // Aqui você carregaria o PDV real
            // Por enquanto, vamos mostrar um placeholder
            setTimeout(() => {
                pdvContent.innerHTML = `
                    <div style="padding: 2rem;">
                        <div style="background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 2rem; text-align: center;">
                            <i class="fas fa-cash-register" style="font-size: 4rem; color: var(--accent-color); margin-bottom: 1rem;"></i>
                            <h3 style="color: var(--dark-color); margin-bottom: 1rem;">PDV Adega Carregado</h3>
                            <p style="color: var(--gray-color); margin-bottom: 2rem;">
                                Sistema de ponto de venda pronto para uso!
                            </p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button class="btn btn-primary" onclick="startNewSale()">
                                    <i class="fas fa-plus"></i> Nova Venda
                                </button>
                                <button class="btn btn-success" onclick="showProducts()">
                                    <i class="fas fa-box"></i> Ver Produtos
                                </button>
                                <button class="btn btn-warning" onclick="showReports()">
                                    <i class="fas fa-chart-bar"></i> Relatórios
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 2rem; background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 2rem;">
                            <h4 style="color: var(--dark-color); margin-bottom: 1rem;">Status do Sistema</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent-color);">0</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-color);">Vendas Hoje</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--success-color);">R$ 0,00</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-color);">Receita Hoje</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--warning-color);">0</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-color);">Produtos</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                pdvContent.dataset.loaded = 'true';
            }, 2000);
        }

        function reloadPDV() {
            const pdvContent = document.getElementById('pdvContent');
            pdvContent.dataset.loaded = 'false';
            loadPDV();
        }

        function startNewSale() {
            alert('Iniciando nova venda...');
            // Aqui você implementaria a lógica de nova venda
        }

        function showProducts() {
            alert('Abrindo gestão de produtos...');
        }

        function showReports() {
            alert('Abrindo relatórios...');
        }

        // ===== FUNÇÕES DE PLANOS E PAGAMENTO =====
        function selectPlan(planName, price) {
            selectedPlanData = {
                name: planName,
                price: price,
                date: new Date().toISOString()
            };
            
            // Atualizar resumo do pedido
            document.getElementById('selectedPlanName').textContent = planName;
            document.getElementById('selectedPlanPrice').textContent = `R$ ${price.toFixed(2)}`;
            document.getElementById('totalPrice').textContent = `R$ ${price.toFixed(2)}`;
            
            // Mostrar seção de pagamento
            showSection('payment');
            
            // Mostrar resumo do pedido
            document.getElementById('orderSummary').style.display = 'block';
            
            // Gerar PIX
            setTimeout(() => {
                generatePixPayment(planName, price);
            }, 500);
        }

        async function generatePixPayment(planName, price) {
            try {
                // Atualizar status
                document.getElementById('pixStatus').innerHTML = `
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Gerando QR Code PIX...</span>
                `;
                
                // Simulação de geração de PIX
                // Em produção, você integraria com a API do Mercado Pago
                
                const pixData = {
                    qrCode: await generateQRCode(`PDV Adega - Plano ${planName} - R$ ${price}`),
                    pixCode: `00020126580014BR.GOV.BCB.PIX0136${Math.random().toString(36).substr(2, 36)}5204000053039865802BR5913PDV ADEGA6009SAO PAULO62070503***6304E2CA`
                };
                
                // Atualizar interface
                document.getElementById('pixQrCode').innerHTML = `<img src="${pixData.qrCode}" alt="QR Code PIX" style="width: 100%; height: auto;">`;
                document.getElementById('pixCode').textContent = pixData.pixCode;
                
                document.getElementById('pixStatus').innerHTML = `
                    <i class="fas fa-clock"></i>
                    <span>Aguardando pagamento...</span>
                `;
                document.getElementById('pixStatus').className = 'pix-status pending';
                
                document.getElementById('pixContent').style.display = 'block';
                
                // Iniciar timer
                startPaymentTimer();
                
                // Salvar transação
                await saveTransaction(pixData, planName, price);
                
            } catch (error) {
                console.error('Erro ao gerar PIX:', error);
                document.getElementById('pixStatus').innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Erro ao gerar PIX. Tente novamente.</span>
                `;
                document.getElementById('pixStatus').className = 'pix-status error';
            }
        }

        async function generateQRCode(text) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                QRCode.toCanvas(canvas, text, {
                    width: 250,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, () => {
                    resolve(canvas.toDataURL());
                });
            });
        }

        function startPaymentTimer() {
            clearInterval(timerInterval);
            timeLeft = 30 * 60;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                document.getElementById('pixTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('expiryTime').textContent = 
                    `${minutes} minutos e ${seconds} segundos`;
                
                if (timeLeft < 300) {
                    document.getElementById('pixTimer').className = 'timer timer-warning';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('pixTimer').className = 'timer';
                    document.getElementById('pixTimer').textContent = 'Expirado';
                    
                    document.getElementById('pixStatus').innerHTML = `
                        <i class="fas fa-times-circle"></i>
                        <span>QR Code expirado</span>
                    `;
                    document.getElementById('pixStatus').className = 'pix-status error';
                }
            }, 1000);
        }

        async function saveTransaction(pixData, planName, price) {
            if (!currentUser) return;
            
            const transaction = {
                id: 'pix_' + Date.now(),
                userId: currentUser.uid,
                plan: planName,
                price: price,
                pixCode: pixData.pixCode,
                status: 'pending',
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 30 * 60 * 1000).toISOString()
            };
            
            try {
                await database.ref('transactions/' + transaction.id).set(transaction);
                pixTransactionId = transaction.id;
            } catch (error) {
                console.error('Erro ao salvar transação:', error);
            }
        }

        function copyPixCode() {
            const pixCode = document.getElementById('pixCode').textContent;
            const copyBtn = document.getElementById('copyBtn');
            
            navigator.clipboard.writeText(pixCode)
                .then(() => {
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copiado!';
                    copyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                })
                .catch(err => {
                    console.error('Erro ao copiar:', err);
                    alert('Erro ao copiar. Selecione e copie manualmente (Ctrl+C).');
                });
        }

        async function verifyPayment() {
            if (!pixTransactionId || !selectedPlanData) {
                alert('Nenhum pagamento encontrado. Selecione um plano primeiro.');
                return;
            }
            
            // Simular verificação de pagamento
            // Em produção, você verificaria com a API do Mercado Pago
            
            document.getElementById('pixStatus').innerHTML = `
                <i class="fas fa-spinner fa-spin"></i>
                <span>Verificando pagamento...</span>
            `;
            
            setTimeout(async () => {
                // Simulação: 80% de chance de sucesso
                const isSuccess = Math.random() > 0.2;
                
                if (isSuccess) {
                    // Pagamento confirmado
                    document.getElementById('pixStatus').innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <span>Pagamento confirmado!</span>
                    `;
                    document.getElementById('pixStatus').className = 'pix-status';
                    
                    // Atualizar plano do usuário
                    await activateUserPlan();
                    
                    // Mostrar mensagem de sucesso
                    showModalMessage('Pagamento Confirmado!', `
                        <p>Seu pagamento foi processado com sucesso!</p>
                        <p><strong>Plano:</strong> ${selectedPlanData.name}</p>
                        <p><strong>Valor:</strong> R$ ${selectedPlanData.price.toFixed(2)}</p>
                        <p>Agora você pode acessar o PDV Adega completo!</p>
                    `, () => {
                        showSection('pdv');
                    });
                    
                } else {
                    // Pagamento pendente
                    document.getElementById('pixStatus').innerHTML = `
                        <i class="fas fa-clock"></i>
                        <span>Aguardando confirmação do pagamento...</span>
                    `;
                    document.getElementById('pixStatus').className = 'pix-status pending';
                    
                    showModalMessage('Pagamento Pendente', `
                        <p>Seu pagamento ainda não foi confirmado.</p>
                        <p>Isso pode levar alguns minutos. Tente verificar novamente em breve.</p>
                    `);
                }
            }, 2000);
        }

        async function activateUserPlan() {
            if (!currentUser || !selectedPlanData) return;
            
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + 30); // 30 dias de validade
            
            const planData = {
                name: selectedPlanData.name,
                price: selectedPlanData.price,
                status: 'active',
                activatedAt: new Date().toISOString(),
                expiryDate: expiryDate.toISOString()
            };
            
            try {
                // Atualizar dados do usuário
                await database.ref('users/' + currentUser.uid + '/activePlan').set(planData);
                
                // Atualizar transação
                await database.ref('transactions/' + pixTransactionId).update({
                    status: 'approved',
                    approvedAt: new Date().toISOString()
                });
                
                // Atualizar localmente
                currentPlan = planData;
                document.getElementById('currentPlan').textContent = planData.name;
                document.getElementById('expiryDate').textContent = `Expira em: ${formatDate(planData.expiryDate)}`;
                
            } catch (error) {
                console.error('Erro ao ativar plano:', error);
            }
        }

        // ===== FUNÇÕES AUXILIARES =====
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function showModalMessage(title, message, onConfirm = null) {
            document.getElementById('modalBody').innerHTML = message;
            
            const modal = document.getElementById('confirmationModal');
            const confirmBtn = document.getElementById('modalConfirmBtn');
            
            // Configurar botão de confirmação
            if (onConfirm) {
                confirmBtn.onclick = function() {
                    closeModal();
                    onConfirm();
                };
                confirmBtn.textContent = 'OK';
            } else {
                confirmBtn.onclick = closeModal;
                confirmBtn.textContent = 'Fechar';
            }
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('confirmationModal').style.display = 'none';
        }

        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos
            document.getElementById('googleLoginBtn').addEventListener('click', loginWithGoogle);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Fechar modal ao clicar fora
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('confirmationModal');
                if (event.target === modal) {
                    closeModal();
                }
            });
            
            // Inicializar autenticação
            initAuth();
        });

        // ===== FUNÇÕES GLOBAIS =====
        window.copyPixCode = copyPixCode;
        window.verifyPayment = verifyPayment;
        window.selectPlan = selectPlan;
        window.showSection = showSection;
        window.closeModal = closeModal;
        window.reloadPDV = reloadPDV;
        window.startNewSale = startNewSale;
        window.showProducts = showProducts;
        window.showReports = showReports;
    </script>
</body>
</html>
